# Pytanie 20. Protokoły routingu

## Kuba

Protokoły routingu służą do wymiany informacji między routerami dotyczącymi tras między sieciami komputerowymi. Tradycyjne trasowanie jest bardzo proste, bo polega na wykorzystaniu tylko informacji o następnym "przeskoku" (ang. hop). W tym przypadku router tylko kieruje pakiet do następnego routera, bez uwzględnienia na przykład zbyt wielkiego obciążenia czy awarii na dalszej części trasy.

Mimo że dynamiczne trasowanie jest bardzo skomplikowane, to właśnie dzięki niemu Internet jest tak elastyczny i rozwinął się o ponad 8 rzędów wielkości w ciągu ostatnich 40 lat.

Protokoły trasowania robią dwie proste rzeczy:

- Mówią światu, kim są sąsiedzi.
- Mówią sąsiadom, jak wygląda świat.

**Metryka trasowania** jest wartością używaną przez algorytmy trasowania do określenia, która trasa jest lepsza. Brane są pod uwagę: szerokość pasma, opóźnienie, liczba przeskoków, koszt ścieżki, obciążenie, MTU, niezawodność, koszt komunikacji. Tylko najlepsze trasy przechowywane są w tablicach trasowania, podczas gdy inne mogą być przechowywane w bazach danych. Jeśli router korzysta z mechanizmów równoważenia obciążenia (ang. load balancing), w tablicy trasowania może wystąpić kilka najlepszych tras. Router będzie je wykorzystywał równolegle, rozpraszając obciążenie równomiernie między trasami.

Proces wyznaczania optymalnej ścieżki dla pakietów danych w sieci. **Urządzenia (routery) wymieniają się informacjami o dostępnych trasach** za pomocą protokołów routingu, budując Tablicę Routingu.

**Kluczowym pojęciem jest System Autonomiczny (AS - Autonomous System)** – zbiór sieci pod jedną administracją (np. ISP, korporacja).

### Klasyfikacja protokołów (Podejście Cisco)

#### A. Ze względu na obszar działania (AS)

- **IGP** (Interior Gateway Protocols): Działają wewnątrz AS (RIP, EIGRP, OSPF, IS-IS).
- **EGP** (Exterior Gateway Protocols): Działają pomiędzy AS (BGP).

#### B. Ze względu na sposób działania (Algorytm)

- **Distance Vector (Wektor odległości):** Router widzi sieć tylko oczami sąsiadów ("Sąsiad A mówi, że do sieci X jest 5 skoków"). Nie zna pełnej mapy sieci. Przykłady: RIP (algorytm Bellmana-Forda).
- **Link State (Stan łącza):** Router posiada pełną mapę całej sieci (każdy router wie o każdym łączu). Przykłady: OSPF, IS-IS (algorytm Dijkstry / SPF).
- **Hybrid / Advanced Distance Vector:** Łączy cechy obu powyższych. Przykład: EIGRP (algorytm DUAL).

#### C. Ze względu na obsługę masek (Ważne na Cisco!)

- **Classful (Klasowe):** Nie przesyłają maski podsieci w aktualizacjach. Nie obsługują VLSM (Stare: RIPv1, IGRP).
- **Classless (Bezklasowe):** Przesyłają maskę podsieci. Obsługują VLSM (zmienną długość maski) i CIDR (Współczesne: RIPv2, EIGRP, OSPF, BGP).

### Protokoły sieci rozległych

#### RIP (Routing Information Protocol)

Router wysyła do sąsiednich routerów informacje dotyczące jego tablicy routingu. Router otrzymujący takie informacje aktualizuje swoją tablicę, zapisując jednocześnie odległość (w sensie liczby skoków), jaka dzieli go od danej sieci. Wybierane są ścieżki o najmniejszym koszcie. Używa algorytmu Forda-Bellmana. W wersji RIPv1 używa trasowania klasowego, w wersji RIPv2 – trasowania bezklasowego. Protokół wewnętrzny, wektora odległości.

- **Wersje:** RIPv1 (Classful), RIPv2 (Classless - obsługuje VLSM).
- **Typ:** Wektor odległości.
- **Algorytm:** Bellmana-Forda.
- **Metryka:** Liczba skoków (Hop Count). Max **15 skoków** (16 = nieskończoność/sieć nieosiągalna).
- **Cechy:** Wysyła pełną tablicę routingu co 30 sekund (multicast 224.0.0.9 dla v2). Wolna zbieżność, podatny na pętle routingu. Przykład: Prosty do małych sieci, ale nie skalowalny.

#### OSPF (Open Shortest Path First)

Shortest Path First, wybierana jest najkrótsza ścieżka do miejsca przeznaczenia. Routery wysyłają do siebie pakiety informacyjne, dzięki temu każdy z nich ma bogatą informację o topologii sieci. Następnie używany jest algorytm Dijkstry do znalezienia najbardziej korzystej (najkrótszej) ścieżki. O wiele bardziej skalowalny i dokładny niż RIP. Protokół wewnętrzny, stanu łącza.

- **Typ:** Stan łącza (Link State).
- **Algorytm:** Dijkstry (SPF - Shortest Path First).
- **Metryka:** Koszt (Cost) = $$\frac{10^8}{\text{Przepustowość}}$$. Im szybsze łącze, tym niższy koszt.

**Struktura:**

- **Tablica Sąsiadów (Neighbor Table):** Lista routerów, z którymi nawiązano relację (Hello packets).
- **Tablica Topologii (LSDB):** Pełna mapa sieci (taka sama na każdym routerze w obszarze).
- **Tablica Routingu:** Tylko najlepsze trasy wyliczone z LSDB.

**Obszary (Areas):** Wymaga hierarchii. Wszystkie obszary muszą stykać się z **Area 0 (Backbone)**. Przykład: Duże korporacje używają OSPF dla skalowalności.

#### IS-IS (Intermediate System to Intermediate System)

Praktycznie to samo, co OSPF, ale: OSPF działa na (z ang. on top of IP) warstwie drugiej modelu ISO/OSI, natomiast IS-IS jest protokołem warstwy trzeciej. Wynika z tego, że OSPF jest uzależniony w działaniu od protokołu IP, natomiast IS-IS ma serdecznie gdzie, jaki protokół warstwy sieciowej jest aktualnie używany do normalnego ruchu w sieci.

- **Typ:** Stan łącza.
- **Algorytm:** Dijkstry.
- **Cechy:** Podobny do OSPF, ale niezależny od IP (może działać z IPv6, CLNS). Używany w dużych sieciach (np. przez operatorów telekomunikacyjnych). Przykład: ISP używają IS-IS zamiast OSPF dla elastyczności.

#### IGRP (Interior Gateway Routing Protocol)

Protokół wewnętrzny, wektora odległości. Podobnie jak RIP, ale w RIP-ie jako metryki używa się liczby skoków do miejsca przeznaczenia, natomiast tutaj metryką jest szerokość pasma, jego obciążenie, opóźnienie i niezawodność. Obsługuje średnie sieci. Protokół własnościowy CISCO. Jego następcą jest EIGRP, który używa już trasowania bezklasowego.

- **Typ:** Wektor odległości.
- **Metryka:** Szerokość pasma, obciążenie, opóźnienie, niezawodność.
- **Cechy:** Starszy protokół Cisco, zastąpiony przez EIGRP. Przykład: Używany w sieciach Cisco przed EIGRP.

#### BGP (Border Gateway Protocol)

Protokół zewnętrzny, używany do wymiany informacji między różnymi systemami autonomicznymi. Nie używa tradycyjnych metryk, ale zestawu atrybutów. Aktualna wersja jest podstawą działania Internetu. Protokół działa przy użyciu protokołu TCP, przez co cechuje go duża niezawodność. Routery BGP wymieniają informacje z innymi routerami BGP o ich osiągalności w sieci Internet, informacje te zawierają listę systemów, przez jakie muszą przejść dane, aby dotrzeć do adresata.

- **Typ:** Wektor ścieżki (Path Vector).
- **Zastosowanie:** Internet, łączenie ISP.
- **Cechy:** Bardzo wolny, ale skalowalny (obsługuje miliony tras). Decyzje oparte na atrybutach (AS-PATH, Local Preference, MED), a nie tylko na prędkości. Przykład: Łączy różne AS w Internecie.

### Szczegółowy opis protokołów

#### 1. RIP (Routing Information Protocol)

- **Wersje:** RIPv1 (Classful), RIPv2 (Classless - obsługuje VLSM).
- **Typ:** Wektor odległości.
- **Algorytm:** Bellmana-Forda.
- **Metryka:** Liczba skoków (Hop Count). Max **15 skoków** (16 = nieskończoność/sieć nieosiągalna).
- **Cechy:** Wysyła pełną tablicę routingu co 30 sekund (multicast 224.0.0.9 dla v2). Wolna zbieżność, podatny na pętle routingu.

#### 2. OSPF (Open Shortest Path First)

- **Typ:** Stan łącza (Link State).
- **Algorytm:** Dijkstry (SPF - Shortest Path First).
- **Metryka:** Koszt (Cost) = $$\frac{10^8}{\text{Przepustowość}}$$

Im szybsze łącze, tym niższy koszt.

**Struktura:**

- **Tablica Sąsiadów (Neighbor Table):** Lista routerów, z którymi nawiązano relację (Hello packets).
- **Tablica Topologii (LSDB):** Pełna mapa sieci (taka sama na każdym routerze w obszarze).
- **Tablica Routingu:** Tylko najlepsze trasy wyliczone z LSDB.

**Obszary (Areas):** Wymaga hierarchii. Wszystkie obszary muszą stykać się z **Area 0 (Backbone)**.

#### 3. EIGRP (Enhanced Interior Gateway Routing Protocol)

- **Typ:** Hybrydowy (Cisco nazywa go "Advanced Distance Vector").
- **Algorytm:** DUAL (Diffusing Update Algorithm) – klucz do szybkości EIGRP. Gwarantuje brak pętli.
- **Metryka:** Złożona (K-values). Domyślnie: Przepustowość (Bandwidth) + Opóźnienie (Delay).

$$\text{Metryka} = \left[\frac{10^7}{\text{MinBW}} + \frac{\text{SumDelay}}{10}\right] \times 256$$

**Cechy:**

- Najszybsza konwergencja (zbieżność) dzięki Feasible Successor (zapasowa trasa gotowa do użycia natychmiast po awarii głównej).
- Obsługuje Unequal Cost Load Balancing (rozłożenie ruchu na łącza o różnej prędkości).
- Protokół własnościowy Cisco (choć częściowo otwarty w 2013).

#### 4. BGP (Border Gateway Protocol)

- **Typ:** Wektor ścieżki (Path Vector).
- **Zastosowanie:** Internet, łączenie ISP.
- **Cechy:**
  - Bardzo wolny, ale skalowalny (obsługuje miliony tras).
  - Decyzje oparte na atrybutach (AS-PATH, Local Preference, MED), a nie tylko na prędkości.

### Dystans Administracyjny (AD) - Komu ufa router?

Gdy router ma trasę do tej samej sieci z dwóch źródeł, wybiera tę z **niższym AD**.

| Źródło trasy             | AD (Zaufanie) |
| ------------------------ | ------------- |
| Connected (Bezpośrednia) | 0             |
| Static (Statyczna)       | 1             |
| EIGRP Summary            | 5             |
| eBGP                     | 20            |
| EIGRP (Internal)         | 90            |
| OSPF                     | 110           |
| RIP                      | 120           |

### Podsumowanie na obronie

- ✅ **Protokoły routingu:** Wymiana info między routerami o trasach; dynamiczne umożliwiają elastyczność Internetu.
- ✅ **Metryka:** Szerokość pasma, opóźnienie, hop count, koszt; najlepsze trasy w tablicy, load balancing dla równoważenia.
- ✅ **RIP:** Wektor odległości, Bellman-Ford, hop count (max 15), wolny, klasowy/bezklasowy.
- ✅ **OSPF:** Stan łącza, Dijkstra, koszt (bandwidth), obszary (Area 0), skalowalny.
- ✅ **IS-IS:** Podobny do OSPF, ale niezależny od IP, dla dużych sieci.
- ✅ **IGRP:** Wektor odległości, metryka złożona (bandwidth, delay), własnościowy Cisco, zastąpiony EIGRP.
- ✅ **BGP:** Wektor ścieżki, między AS, atrybuty (AS-PATH), podstawa Internetu.
- ✅ **Klasyfikacja:** IGP/EGP, Distance Vector/Link State/Hybrid, Classful/Classless.
- ✅ **AD:** Kolejność zaufania (Connected > Static > EIGRP > OSPF > RIP).

Najważniejsze to zrozumieć różnice między protokołami: RIP prosty ale wolny, OSPF skalowalny z pełną mapą, BGP dla Internetu. Wybór zależy od wielkości sieci i wymagań.

## Stachu

## Szczegółowy opis protokołów

### 1. RIP (Routing Information Protocol)

- **Wersje:** RIPv1 (Classful), RIPv2 (Classless - obsługuje VLSM)
- **Typ:** Wektor odległości
- **Algorytm:** Bellmana-Forda
- **Metryka:** Liczba skoków (Hop Count). Max **15 skoków** (16 = nieskończoność/sieć nieosiągalna)
- **Cechy:** Wysyła pełną tablicę routingu co 30 sekund (multicast 224.0.0.9 dla v2). Wolna zbieżność, podatny na pętle routingu

### 2. OSPF (Open Shortest Path First)

- **Typ:** Stan łącza (Link State)
- **Algorytm:** Dijkstry (SPF - Shortest Path First)
- **Metryka:** Koszt (Cost) = $$\frac{10^8}{\text{Przepustowość}}$$
  Im szybsze łącze, tym niższy koszt

**Struktura:**

- **Tablica Sąsiadów (Neighbor Table):** Lista routerów, z którymi nawiązano relację (Hello packets)
- **Tablica Topologii (LSDB):** Pełna mapa sieci (taka sama na każdym routerze w obszarze)
- **Tablica Routingu:** Tylko najlepsze trasy wyliczone z LSDB

**Obszary (Areas):** Wymaga hierarchii. Wszystkie obszary muszą stykać się z **Area 0 (Backbone)**.

### 3. EIGRP (Enhanced Interior Gateway Routing Protocol)

- **Typ:** Hybrydowy (Cisco nazywa go "Advanced Distance Vector")
- **Algorytm:** DUAL (Diffusing Update Algorithm) – klucz do szybkości EIGRP. Gwarantuje brak pętli
- **Metryka:** Złożona (K-values). Domyślnie: Przepustowość (Bandwidth) + Opóźnienie (Delay)

$$\text{Metryka} = \left[\frac{10^7}{\text{MinBW}} + \frac{\text{SumDelay}}{10}\right] \times 256$$

**Cechy:**

- Najszybsza konwergencja (zbieżność) dzięki Feasible Successor (zapasowa trasa gotowa do użycia natychmiast po awarii głównej)
- Obsługuje Unequal Cost Load Balancing (rozłożenie ruchu na łącza o różnej prędkości)
- Protokół własnościowy Cisco (choć częściowo otwarty w 2013)

### 4. BGP (Border Gateway Protocol)

- **Typ:** Wektor ścieżki (Path Vector)
- **Zastosowanie:** Internet, łączenie ISP
- **Cechy:**
  - Bardzo wolny, ale skalowalny (obsługuje miliony tras)
  - Decyzje oparte na atrybutach (AS-PATH, Local Preference, MED), a nie tylko na prędkości

## Dystans Administracyjny (AD) - Komu ufa router?

Gdy router ma trasę do tej samej sieci z dwóch źródeł, wybiera tę z **niższym AD**.

| Źródło trasy             | AD (Zaufanie) |
| ------------------------ | ------------- |
| Connected (Bezpośrednia) | 0             |
| Static (Statyczna)       | 1             |
| EIGRP Summary            | 5             |
| eBGP                     | 20            |
| EIGRP (Internal)         | 90            |
| OSPF                     | 110           |
| RIP                      | 120           |

## Streszczenie

- ✅ **Klasyfikacja:** IGP vs EGP, Distance Vector vs Link State, Classful vs Classless (VLSM)
- ✅ **RIP:** Algorytm Bellmana-Forda, metryka Hop Count (max 15), wolny
- ✅ **OSPF:** Algorytm Dijkstry, Link State, metryka Koszt (Bandwidth), Area 0, trzy tablice (Neighbor, Topology, Routing)
- ✅ **EIGRP:** Algorytm DUAL, metryka Bandwidth+Delay, Feasible Successor (zapasowa trasa), bardzo szybki
- ✅ **AD:** Kolejność zaufania (Static > EIGRP > OSPF > RIP)
