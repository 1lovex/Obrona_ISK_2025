# Pytanie 8 - Mechanizmy systemu operacyjnego wspomagające synchronizację procesów

## **Kuba**

System operacyjny zarządza procesami, które często muszą ze sobą współpracować lub korzystać z tych samych zasobów. Synchronizacja jest niezbędna, aby uniknąć błędów, niespójności danych oraz konfliktów o dostęp do sprzętu.

---

### 1. Podstawowe pojęcia

- **Proces**: Wykonujący się program, podstawowa jednostka pracy systemu operacyjnego. Do działania potrzebuje zasobów (czas procesora, pamięć RAM, pliki).
- **Sekcja krytyczna**: Fragment kodu, w którym proces korzysta ze współdzielonego zasobu (np. zapisuje dane do wspólnej pamięci).

**Warunki poprawnego rozwiązania sekcji krytycznej:**

- **Wzajemne wykluczanie**: Tylko jeden proces może być w sekcji krytycznej w danym momencie.
- **Brak zatrzymania**: Proces nie może zatrzymać się na stałe wewnątrz sekcji krytycznej.
- **Postęp**: Procesy czekające na wejście do sekcji nie mogą być blokowane przez procesy będące poza nią.
- **Ograniczone oczekiwanie**: Każdy proces musi w końcu otrzymać dostęp (brak zagłodzenia).

---

### 2. Typowe problemy synchronizacji

- **Problem Producenta i Konsumenta**: Producent tworzy dane i wkłada je do bufora, a konsument je pobiera. Synchronizacja jest potrzebna, by producent nie przepełnił bufora, a konsument nie próbował czytać z pustego.
- **Problem Czytelników i Pisarzy**: Wielu czytelników może czytać dane jednocześnie, ale pisarz musi mieć dostęp wyłączny (nikt inny nie może wtedy czytać ani pisać).
- **Problem Ucztujących Filozofów**: Ilustruje rywalizację o ograniczoną liczbę zasobów. Może prowadzić do zakleszczenia, jeśli każdy weźmie po jednym zasobie i będzie czekał na drugi.

---

### 3. Zagrożenia w procesach współbieżnych

- **Zakleszczenie (Deadlock)**: Sytuacja, w której co najmniej dwa procesy wzajemnie czekają na zasoby trzymane przez siebie nawzajem. Żaden nie może ruszyć dalej.
- **Zagłodzenie (Starvation)**: Sytuacja, w której proces nigdy nie otrzymuje dostępu do zasobu, ponieważ inne procesy są ciągle traktowane priorytetowo.
- **Aktywne czekanie**: Proces w pętli ciągle sprawdza warunek wejścia do sekcji krytycznej, marnując czas procesora (charakterystyczne dla spinlocków).

---

### 4. Mechanizmy synchronizacji

#### 4.1 Muteks (Mutual Exclusion)

- **Szczególny przypadek semafora binarnego**: (wartości 0 lub 1).
- **Własność**: Tylko ten proces, który zablokował muteks, może go odblokować.
- **Zastosowanie**: Prosta ochrona jednej sekcji krytycznej.

#### 4.2 Semafory (Dijkstry)

- **Zmienna licznikowa**: Służąca do kontroli dostępu do zasobów.
- **Binarne**: Działają jak muteksy (0/1).
- **Zliczające**: Pozwalają dopuścić określoną liczbę procesów (np. 5 procesów do puli 5 drukarek).
- **Operacje**: wait (zmniejszenie licznika/zajęcie) oraz signal (zwiększenie licznika/zwolnienie).
- **Kolejkowanie**: Procesy czekające mogą być w kolejce FIFO (semafory silne) lub bez określonej kolejności (semafory słabe).

#### 4.3 Monitory

- **Strukturalne narzędzie synchronizacji wyższego poziomu**: (często definiowane jako klasy).
- **Zasada**: Wszystkie zmienne i procedury są zamknięte w jednym module.
- **Bezpieczeństwo**: Dostęp do monitora ma tylko jeden proces naraz. Metody monitora są automatycznie chronione przed współbieżnym dostępem.
- **Zmienne warunkowe**: Pozwalają procesom zawiesić działanie (wait) wewnątrz monitora i czekać na sygnał od innego procesu (signal).

#### 4.4 Spinlocki

- **Podobne do muteksów**: Ale zamiast usypiać proces, zmuszają go do "kręcenia się" w pętli (aktywne czekanie) aż zasób zostanie zwolniony.
- **Zastosowanie**: Bardzo krótkie sekcje krytyczne, gdzie koszt uśpienia procesu byłby większy niż czas czekania.

#### 4.5 Kolejka komunikatów

- **Mechanizm przesyłania danych między procesami**: Gdzie komunikaty są uporządkowane w kolejce (FIFO lub priorytetowej). Pozwala na asynchroniczną współpracę procesów.

---

### 5. Podsumowanie różnic (Warto zapamiętać)

| Cecha         | Muteks                                                   | Semafor                                          |
| ------------- | -------------------------------------------------------- | ------------------------------------------------ |
| Właściciel    | Zapamiętuje, kto założył blokadę.                        | Nie posiada pojęcia właściciela.                 |
| Zwalnianie    | Tylko właściciel może zwolnić blokadę.                   | Każdy proces może podnieść semafor.              |
| Liczba wątków | Zawsze tylko jeden naraz.                                | Może dopuścić wiele wątków (semafor zliczający). |
| Rekurencja    | Może być rekurencyjny (liczy blokady tego samego wątku). | Zazwyczaj nie jest rekurencyjny.                 |

---

### Podsumowanie na obronie

Mechanizmy synchronizacji procesów w systemach operacyjnych, takie jak muteksy, semafory, monitory i spinlocki, są kluczowe dla zapewnienia bezpiecznej współbieżności. Umożliwiają one unikanie problemów takich jak zakleszczenia czy zagłodzenie, zapewniając poprawne współdzielenie zasobów między procesami. Zrozumienie tych mechanizmów jest niezbędne dla efektywnego programowania wielowątkowego i systemów rozproszonych.

## Stachu

[Kozak link](https://lucc.pl/inf/egzamin_inzynierski/kierunkowe/%5BK%5D%5B8%5D%20Mechanizmy%20systemu%20operacyjnego%20wspomagajace%20synchronizacje%20procesow/tekst/1.pdf)

- **Semafory**
  Chroniona zmienna lub abstrakcyjny typ danych, który stanowi klasyczną metodę kontroli dostępu przez wiele procesów do wspólnego zasobu w środowisku programowania równoległego. Semafory zostały po raz pierwszy opisane przez Edsgera Dijkstrę jako istotne rozwinięcie algorytmu Dekkera.
  Typowy semafor implementowany jest jako zmienna typu całkowitego. Semafory dzieli się na binarne i zliczające. Semafor binarny może przyjmować wartości całkowite ze zbioru {0, 1}, zliczający – również większe niż 1. Semafor zliczający jest licznikiem zestawu dostępnych zasobów. Każdy z nich może być zastosowany, by zapobiec wystąpieniu zjawiska hazardu lub zakleszczenia (chociaż nie w każdej sytuacji są w stanie wyeliminować te problemy, co ilustruje problem ucztujących filozofów).
- **Mutexy**
  Na systemach jedno-procesorowych najczęstszym sposobem wzajemnego wykluczania w jądrach systemów operacyjnych jest wyłączenie przerwań dla jak najmniejszej liczby instrukcji kodu, chroniąc przed uszkodzeniem struktury dzielonych danych sekcji krytycznej. Zapobiega to uruchamianiu kodu w sekcji krytycznej oraz chroni przed zmianami procesów opartych na technologii przerwań.
  W komputerach, które dzielą pamięć między własnymi procesorami, niepodzielna instrukcja test-and-set flagi jest używana w pętlach w celu przeczekania do momentu aż procesor wyczyści flagę. Instrukcja ta przeprowadza dwie operacje bez wypuszczania pamięci z wyłączności. Kiedy kod opuszcza sekcje krytyczną, czyści flagę. Nazywa się to „Spinlock” lub „Busy wait”.
  Podobną operacją atomową jest “compare-and-swap” używana do synchronizacji nieblokującej dla list łączonych i innych struktur danych.
- **Wątki**
  Część programu wykonywana współbieżnie w obrębie jednego procesu; w jednym procesie może istnieć wiele wątków.
  Różnica między zwykłym procesem a wątkiem polega na współdzieleniu przez wszystkie wątki działające w danym procesie przestrzeni adresowej oraz wszystkich innych struktur systemowych (np. listy otwartych plików, gniazd itp.) – z kolei procesy posiadają niezależne zasoby.
- **Zmienne warunkowe**
  Jest jednym ze sposobów synchronizacji między wątkami - polega na przesłaniu sygnału z jednego wątku do innych wątków, które na ten sygnał oczekują.
- **Sekcja krytyczna**
  Fragment kodu programu, w którym korzysta się z zasobu dzielonego, a co za tym idzie, w danej chwili może być wykorzystywany przez co najwyżej jeden wątek
