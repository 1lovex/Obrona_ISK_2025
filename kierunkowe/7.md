# Pytanie 7 - Generowanie realistycznych obrazów scen 3-D za pomocą metody śledzenia promieni

## Kuba

Metoda śledzenia promieni (Ray Tracing) to technika służąca do generowania fotorealistycznych obrazów trójwymiarowych. Jej celem jest jak najdokładniejsze odwzorowanie praw fizyki rządzących światłem w świecie rzeczywistym.

### Idea ogólna: Dlaczego "wstecz"?

W naturze światło biegnie od źródła, odbija się od przedmiotów i trafia do oka. Jednak symulowanie wszystkich promieni ze źródła światła (próbkowanie przestrzeni) jest nieefektywne, ponieważ większość z nich nigdy nie trafi do obserwatora.

**Ray Tracing (Śledzenie wsteczne):**

- Promienie są wyprowadzane od oka obserwatora przez każdy piksel rzutni (ekranu) w głąb sceny.
- Śledzimy tylko te promienie, które faktycznie budują obraz widziany przez użytkownika.
- Jest to proces dyskretny – jeden piksel odpowiada zazwyczaj (w podstawowej wersji) jednemu promieniowi pierwotnemu.

### Przebieg algorytmu (Krok po kroku)

Działanie algorytmu można zapisać w formie drzewa, gdzie korzeniem jest promień pierwotny, a liśćmi punkty, w których śledzenie się kończy.

- **Promień pierwotny**: Dla każdego piksela wyprowadź promień z punktu obserwacji.
- **Test przecięcia**: Znajdź najbliższy obiekt, w który uderzył promień.
- **Oświetlenie lokalne**: Oblicz kolor w punkcie przecięcia (np. modelem Phonga).
- **Promienie pomocnicze (Cienie)**: Wyprowadź promienie w stronę źródeł światła. Jeśli po drodze jest przeszkoda, punkt znajduje się w cieniu.
- **Promienie wtórne (Rekurencja)**: Jeśli obiekt jest lustrzany lub przezroczysty, wyprowadź promienie odbite i załamane.
- **Złożenie koloru**: Zsumuj wyniki z całego "drzewa" promieni, aby ustalić ostateczny kolor piksela.

**Warunki zakończenia śledzenia:**

- Promień nie trafia w żaden obiekt (leci w tło).
- Promień trafia w obiekt całkowicie matowy (rozpraszający).
- Osiągnięto maksymalną głębokość rekursji (limit odbić).
- Nastąpiło całkowite wewnętrzne odbicie.

### 3. Modele oświetlenia (Lokalne oświetlenie)

Aby wyliczyć kolor punktu, stosuje się matematyczne modele opisujące zachowanie światła na powierzchni.

#### Model Phonga (Najpopularniejszy model empiryczny)

Jest to najczęściej omawiany model, ponieważ stanowi idealny kompromis między realizmem a złożonością obliczeń. Składa się z trzech składowych:

- **Ambient (Otoczenie)**: Stałe światło docierające zewsząd, zapobiega całkowitej czerni w cieniach.
- **Diffuse (Rozproszone)**: Podstawowy kolor obiektu (matowy). Zależy od kąta padania światła (Prawo Lamberta).
- **Specular (Lustrzane)**: Odpowiada za lśnienie i błyski na gładkich powierzchniach.

#### Inne modele oświetlenia

- **Model Lamberta**: Najprostszy model, uwzględnia tylko światło rozproszone. Idealny dla idealnie matowych powierzchni (np. kreda, papier).
- **Model Blinna-Phonga**: Optymalizacja modelu Phonga, stosowana w DirectX i OpenGL. Jest szybszy w obliczeniach i lepiej oddaje blaski przy dużych kątach.
- **Modele PBR (Physically Based Rendering)**: Np. Cook-Torrance. To nowoczesne modele stosowane w fotorealistycznych silnikach (Unreal Engine, Blender Cycles). Opierają się na fizycznych właściwościach materiałów (chropowatość, metaliczność) i zachowaniu zasady zachowania energii.

Dodatkowo modele te uwzględniają tłumienie atmosferyczne – natężenie światła maleje wraz z odległością od obserwatora.

### Wady i Zalety metody

**Zalety:**

- **Fotorealizm**: Doskonałe odwzorowanie cieni, odbić i załamań (np. w szkle czy wodzie).
- **Niezależność**: Kolor każdego piksela można liczyć osobno (łatwa równoległość obliczeń).
- **Uniwersalność**: Pozwala na symulowanie złożonych zjawisk optycznych.

**Wady:**

- **Koszt obliczeniowy**: Wymaga ogromnej mocy obliczeniowej (liczenie milionów kolizji promieni z bryłami).
- **Aliasing**: "Poszarpane" krawędzie wynikające z badania nieskończenie cienkich promieni (wymaga metod Antyaliasingu, np. supersamplingu).
- **Brak efektów globalnych**: Trudno symuluje światło rozproszone (np. światło odbite od czerwonej ściany barwiące biały sufit).

### Podsumowanie na obronie

Ray Tracing to metoda "od oka do źródła". Choć jest kosztowna, obecnie staje się standardem w czasie rzeczywistym dzięki nowoczesnym kartom graficznym (np. NVIDIA CUDA/RTX). Aby zoptymalizować obliczenia, stosuje się tzw. bryły otaczające (prostsze kształty zamykające złożone obiekty) – jeśli promień nie trafi w prostą bryłę, na pewno nie trafi w skomplikowany obiekt wewnątrz niej.

## Stachu

Technika opierająca się na analizie tylko tych promieni, które trafiają bezpośrednio do obserwatora. Z punktu, w którym znajduje się obserwator, wyprowadzany jest promień pierwotny, który przecina rzutnię.

Następnie wyszukiwany jest najbliższy punkt przecięcia z obiektami znajdującymi się na scenie. Dla każdego źródła światła zdefiniowanego na scenie wyznaczana jest jasność w tym punkcie, zgodnie z określonym modelem oświetlenia (np. Lamberta czy Phonga).

Najczęściej także określa się cienie – w tym celu jest testowana widoczność źródła światła z danego punktu, tj. czy światło nie jest przesłaniane przez jakiś obiekt i jeśli nie – dopiero wtedy oblicza się jasność punktu dla tego źródła.

Dodatkowo, jeżeli algorytm jest rekursywny, sprawdzane jest, czy punkt przecięcia należy do obiektu odbijającego światło lub przezroczystego, wysyłane są z tego punktu promienie wtórne – odpowiednio, promień odbity lub promień załamany – i algorytm rekursywnie powtarza się od drugiego kroku (w większości programów można ograniczyć liczbę zejść rekurencyjnych).

Kolor punktu wyznaczany jest, dopiero gdy znane są wyniki przetwarzania promieni wtórnych; Zwykle projektant podaje procentowo wpływ kolorów z promieni wtórnych, tj. określa jak bardzo obiekt odbija/załamuje światło.
