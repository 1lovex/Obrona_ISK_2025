# Pytanie 3 - Normalizacja schematu bazy danych

## Kuba

Normalizacja to proces organizowania danych w bazie w taki sposób, aby wyeliminować **nadmiarowość (redundancję)** i uniknąć problemów związanych ze **spójnością** podczas cyklu życia bazy danych.

## Dlaczego normalizujemy? (Problemy i Anomalie)

Brak odpowiedniej struktury prowadzi do **anomalii**, czyli błędów logicznych podczas pracy z danymi:

- **Anomalia aktualizacji**: Ta sama informacja (np. nazwisko klienta) jest powielona w wielu wierszach. Zmiana w jednym miejscu wymusza zmiany w wielu innych, co grozi brakiem spójności.
- **Anomalia usuwania**: Usunięcie jednego faktu (np. faktury) powoduje niezamierzoną utratę innej informacji (np. jedynego wpisu o istnieniu klienta w systemie).
- **Anomalia wstawiania**: Nie można dodać nowej informacji (np. o nowym towarze), dopóki nie wystąpi inne zdarzenie (np. pierwsza sprzedaż tego towaru), co blokuje rozwój bazy.

### Przykład anomalii

Wyobraźmy sobie tabelę zamówień bez normalizacji:

| **ID_Zamówienia** | Klient       | Adres_Klienta          | Towar  | Cena |
| ----------------- | ------------ | ---------------------- | ------ | ---- |
| 1                 | Jan Kowalski | ul. Główna 1, Warszawa | Laptop | 3000 |
| 2                 | Jan Kowalski | ul. Główna 1, Warszawa | Myszka | 50   |

- Anomalia aktualizacji: Jeśli Jan Kowalski zmieni adres, trzeba zaktualizować wiele wierszy.
- Anomalia usuwania: Usunięcie zamówienia na myszkę usuwa jedyny wpis o Janie Kowalskim.

## Zalety i Wady Normalizacji

| Aspekt              | Zalety                                                         | Wady                                                                       |
| ------------------- | -------------------------------------------------------------- | -------------------------------------------------------------------------- |
| **Spójność danych** | Brak duplikatów to brak sprzecznych informacji.                | Konieczność częstego łączenia tabel (JOIN) spowalnia odczyt.               |
| **Rozmiar bazy**    | Baza zajmuje mniej miejsca na dysku.                           | Złożoność: Zapytania SQL stają się trudniejsze do napisania i zrozumienia. |
| **Modyfikacja**     | Łatwiejsza modyfikacja: Zmieniamy daną tylko w jednym miejscu. | Większa liczba relacji: Model staje się trudniejszy do wizualizacji.       |

## Postaci Normalne (Kroki do ideału)

Każda kolejna postać musi spełniać warunki wszystkich poprzednich (np. 3NF musi być w 2NF i 1NF).

### 1NF (Pierwsza Postać Normalna)

- **Atomowość**: Dane w kolumnach są niepodzielne (np. zamiast kolumny "Adres" mamy "Ulica", "Kod", "Miasto").
- **Brak kolekcji**: W jednej komórce znajduje się tylko jedna wartość (nie ma list typu "Towar1, Towar2").
- **Unikalność**: Każdy wiersz posiada klucz główny (identyfikator).

#### Przykład 1NF

**Przed normalizacją:**

| **ID_Studenta** | Imię | Nazwisko | Kursy              |
| --------------- | ---- | -------- | ------------------ |
| 1               | Anna | Nowak    | Matematyka, Fizyka |
| 2               | Jan  | Kowalski | Informatyka        |

**Po normalizacji (1NF):**

| **ID_Studenta** | Imię | Nazwisko | Kurs        |
| --------------- | ---- | -------- | ----------- |
| 1               | Anna | Nowak    | Matematyka  |
| 1               | Anna | Nowak    | Fizyka      |
| 2               | Jan  | Kowalski | Informatyka |

_Zmiana: Tabela została podzielona na wiersze, gdzie każda komórka zawiera tylko jedną wartość. Kolumna 'Kursy' została zastąpiona wielokrotnymi wierszami dla tego samego studenta, eliminując kolekcje wartości._

### 2NF (Druga Postać Normalna)

- Spełnia 1NF.
- **Pełna zależność od klucza**: Wszystkie kolumny niekluczowe zależą od całego klucza głównego. Jeśli klucz jest złożony (np. ID_Studenta + ID_Kursu), kolumna nie może zależeć tylko od jednego z nich.
  - **Kolumna niekluczowa**: Kolumna, która nie wchodzi w skład klucza głównego tabeli (np. dane opisowe jak imię, ocena).

#### Przykład 2NF

**Przed normalizacją (już 1NF, ale nie 2NF):**

| **ID_Studenta** | **ID_Kursu** | Imię_Studenta | Nazwa_Kursu | Ocena |
| --------------- | ------------ | ------------- | ----------- | ----- |
| 1               | 101          | Anna          | Matematyka  | 5     |
| 1               | 102          | Anna          | Fizyka      | 4     |
| 2               | 101          | Jan           | Matematyka  | 3     |

(Imię_Studenta zależy tylko od ID_Studenta, nie od całego klucza.)

**Po normalizacji (2NF):**

Tabela Studenci:
| **ID_Studenta** | Imię_Studenta |
|-----------------|---------------|
| 1 | Anna |
| 2 | Jan |

Tabela Kursy:
| **ID_Kursu** | Nazwa_Kursu |
|--------------|-------------|
| 101 | Matematyka |
| 102 | Fizyka |

Tabela Oceny:
| **ID_Studenta** | **ID_Kursu** | Ocena |
|-----------------|--------------|-------|
| 1 | 101 | 5 |
| 1 | 102 | 4 |
| 2 | 101 | 3 |

_Zmiana: Dane zostały podzielone na trzy tabele: Studenci (dane o studentach), Kursy (dane o kursach) i Oceny (relacje między studentami a kursami z ocenami). Eliminuje to redundancję danych o studentach i kursach, usuwając zależności częściowe._

### 3NF (Trzecia Postać Normalna)

- Spełnia 2NF.
- **Brak zależności przechodnich**: Żadna kolumna niekluczowa nie może zależeć od innej kolumny niekluczowej. Wszystko musi zależeć bezpośrednio od klucza.
- **Zasada Codd'a**: "Atrybut zależy od klucza, całego klucza i tylko od klucza".

#### Przykład 3NF

**Przed normalizacją (spełnia 2NF, ale nie 3NF):**

| **ID_Pracy** | ID_Pracownika | Nazwa_Pracownika | ID_Działu | Nazwa_Działu |
| ------------ | ------------- | ---------------- | --------- | ------------ |
| 1            | 101           | Jan Kowalski     | 1         | IT           |
| 2            | 102           | Anna Nowak       | 1         | IT           |

(Nazwa_Działu zależy od ID_Działu, nie bezpośrednio od ID_Pracy. Tabela spełnia 2NF, ponieważ klucz główny jest pojedynczy - ID_Pracy - więc wszystkie kolumny niekluczowe zależą od całego klucza. W przeciwieństwie do przykładu w 2NF, gdzie klucz jest złożony i występuje zależność częściowa.)

**Po normalizacji (3NF):**

Tabela Prace:
| **ID_Pracy** | ID_Pracownika | ID_Działu |
|--------------|----------------|-----------|
| 1 | 101 | 1 |
| 2 | 102 | 1 |

Tabela Pracownicy:
| **ID_Pracownika** | Nazwa_Pracownika |
|-------------------|------------------|
| 101 | Jan Kowalski |
| 102 | Anna Nowak |

Tabela Działy:
| **ID_Działu** | Nazwa_Działu |
|----------------|--------------|
| 1 | IT |

_Zmiana: Tabela została podzielona na trzy tabele: Prace (relacje prac), Pracownicy (dane o pracownikach) i Działy (dane o działach). Eliminuje to zależność przechodnią między ID_Działu a Nazwa_Działu, zapewniając, że każda kolumna zależy bezpośrednio od klucza._

### BCNF (Postać Boyce'a-Codda / 3.5NF)

- Spełnia 3NF.
- Wymaga, aby każdy **wyznacznik** (kolumna, od której zależą inne) był kluczem kandydującym. Rozwiązuje rzadkie problemy w tabelach o wielu nakładających się kluczach złożonych.
  - **Klucz kandydujący**: Zestaw kolumn, który może jednoznacznie identyfikować wiersz w tabeli (jest unikalny i minimalny, tzn. nie zawiera zbędnych kolumn).

#### Przykład BCNF

**Przed normalizacją (już 3NF, ale nie BCNF):**

| **Lekarz** | **Pacjent** | Choroba       |
| ---------- | ----------- | ------------- |
| Dr. A      | Jan         | Grypa         |
| Dr. A      | Anna        | Przeziębienie |
| Dr. B      | Jan         | Grypa         |

(Klucz: Lekarz + Pacjent, ale Choroba zależy od Pacjenta, a Pacjent nie jest kluczem.)

**Po normalizacji (BCNF):**

Tabela Wizyty:
| **Lekarz** | **Pacjent** |
|------------|-------------|
| Dr. A | Jan |
| Dr. A | Anna |
| Dr. B | Jan |

Tabela Pacjenci_Choroby:
| **Pacjent** | Choroba |
|-------------|---------|
| Jan | Grypa |
| Anna | Przeziębienie |

_Zmiana: Tabela została podzielona na Wizyty (relacje wizyt) i Pacjenci_Choroby (dane o chorobach pacjentów). Eliminuje to sytuację, gdzie wyznacznik (Pacjent) nie jest kluczem kandydującym, zapewniając, że każdy wyznacznik jest kluczem._

## Podsumowanie na obronę

Normalizacja dąży do zasady **"One Fact in One Place"**. W większości systemów produkcyjnych **3NF** jest uznawana za standard wystarczający. W systemach typu Big Data lub hurtowniach danych czasem stosuje się **denormalizację** (powrót do prostszych struktur), aby drastycznie przyspieszyć odczyt danych kosztem większego ryzyka przy ich modyfikacji.

### Diagram ASCII relacji po normalizacji

```
Studenci --< Oceny >-- Kursy
    |           |
    v           v
Pracownicy --< Prace >-- Działy
```

_Wyjaśnienie: Diagram pokazuje relacje między tabelami po normalizacji. Strzałki (< i >) oznaczają relacje wiele-do-wielu lub jeden-do-wielu. Studenci łączą się z Ocenami (wiele ocen na studenta), Oceny łączą się z Kursami (wiele ocen na kurs). Podobnie Pracownicy łączą się z Pracami, a Prace z Działami. Pionowe linie (|) i strzałki (v) wskazują dodatkowe połączenia między tabelami._

---

---

## Stachu

Normalizacja bazy danych to ustrukturyzowany proces, który reorganizuje informacje w różnych tabelach i relacjach, aby wyeliminować redundancje, uniknąć niespójności i zapewnić integralność przechowywanych danych.

### Postaci Normalne

- **Pierwsza Forma Normalna (1NF)**: Wymaga, aby każda kolumna zawierała wyłącznie pojedyncze, niepodzielne wartości (atomowość danych). Usuwa zagnieżdżone tabele i powtarzające się grupy wartości.
- **Druga Forma Normalna (2NF)**: Eliminuje zależności częściowe poprzez zapewnienie, że każda kolumna zależy od całego klucza głównego, a nie tylko jego części.
- **Trzecia Forma Normalna (3NF)**: Usuwa zależności przechodnie, co oznacza, że każda kolumna musi zależeć bezpośrednio od klucza głównego, a nie od innych kolumn w tabeli.

Trzy są najważniejsze, ale dla pewności napiszę o pozostałych:

- **Czwarta Forma Normalna (4NF)**: Eliminuje zależności wielowartościowe, czyli sytuacje, w których kolumna może mieć więcej niż jedną wartość niezależną od reszty rekordu.
- **Piąta Forma Normalna (5NF)**: Rozbija tabele w taki sposób, aby nie można było ich złożyć w inny sposób niż poprzez ich klucz główny, minimalizując redundancję i eliminując złożone zależności.

### Przykład dla 1NF (Stachu)

**Przed:**

| **ID** | Imię | Hobby           |
| ------ | ---- | --------------- |
| 1      | Jan  | Czytanie, Sport |

**Po:**

| **ID** | Imię | Hobby    |
| ------ | ---- | -------- |
| 1      | Jan  | Czytanie |
| 1      | Jan  | Sport    |

_Zmiana: Tabela została podzielona na wiersze, gdzie każda komórka zawiera tylko jedną wartość. Kolumna 'Hobby' została zastąpiona wielokrotnymi wierszami dla tego samego ID, eliminując kolekcje wartości._

### Podsumowanie

Normalizacja zapewnia czystość danych, ale wymaga kompromisów w wydajności. W praktyce, 3NF pokrywa większość potrzeb.
